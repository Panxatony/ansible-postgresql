---
# Basic settings
el_version: 7
postgresql_version: 10

pg_data: /var/lib/pgsql/{{ postgresql_version }}/data
pg_conf: /var/lib/pgsql/{{ postgresql_version }}/data
archivelog_dir: /var/lib/pgsql/{{ postgresql_version }}/backups/arch
postgresql_admin_user: postgres
postgresql_port: 5432 

# List of databases to be precreated.
databases:
  - postgres

# List of precreated users.
db_users:
  - username: postgres
    password: invalid

# Postgresql.conf defaults
postgresql_conf:
  listen_addresses: "'*'"
  port: "{{ postgresql_port }}"
  max_connections: 250
  shared_buffers: "{{ (ansible_memory_mb.real.total/4) |round|int }}MB"
#  effective_cache_size: "{{ (ansible_memory_mb.real.total }}MB"
  shared_preload_libraries: "'pg_stat_statements,powa,pg_stat_kcache,pg_qualstats'"
  pg_stat_statements.track: "all"
  # compression enabled
  archive_command: "'gzip < %p > {{ archivelog_dir }}/%f'"
  #archive_command: 'cp -i %p /home/postgres/pg_archive/%f'
  max_wal_senders: "10"
  # replica is default in 10 so ommited here.
  #wal_level: 'replica'
  hot_standby: "on"
  archive_mode: "on"
  wal_keep_segments: "5000"
  wal_log_hints: "on"

# Defaults for mamonsu
zabbix_server:
zabbix_server_port: 10051
# moved to template
agent_name: "{% if ansible_dns.search is defined %}{{ inventory_hostname }}.{{ ansible_dns.search[0] }}{% else %}{{ inventory_hostname }}{% endif %}"

# Defaults for pgbouncer.
pgbouncer_port: 6432

pgbouncer_conf:
  listen_addr: "0.0.0.0"
  pool_mode: "transaction"
  ignore_startup_parameters: "extra_float_digits"
  max_client_conn: "300"
  server_reset_query_always: "1"
  listen_port: "{{pgbouncer_port}}"

